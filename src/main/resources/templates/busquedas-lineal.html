<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lineal - Ciencias de la computacion II</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<nav class="navbar">
    <ul class="menu">
        <li><a th:href="@{/}">Inicio</a></li>
        <li><a th:href="@{/busquedas}">Busquedas</a></li>
        <li><a th:href="@{/grafos}">Grafos</a></li>
    </ul>
</nav>
<div class="contenido">
    <div class="titulo">Busquedas - Lineal</div>
    <div class="subtitulo">Página de ejemplo para búsquedas lineales.</div>

    <div style="display:flex; gap:20px; align-items:flex-start; margin-top:16px;">
        <div style="width:320px; text-align:left;">
            <div class="control-panel" style="flex-direction:column; align-items:flex-start; gap:10px;">
                <label>Tamaño de arreglo:</label>
                <select id="size-array">
                    <option value="10">10</option>
                    <option value="100">100</option>
                    <option value="1000">1000</option>
                </select>

                <label style="margin-top:8px;">Tamaño de clave:</label>
                <input id="key-size" type="number" placeholder="(ej. 5)" min="1">

                <button id="accept-btn" style="margin-top:8px;" onclick="aceptarParametros()">Aceptar</button>
            </div>

            <div style="margin-top:18px; padding:14px; background-color:#f9f9f9; border-radius:6px;">
                <h4 style="margin:0 0 8px 0;">Agregar dato (secuencial)</h4>
                <div style="display:flex; gap:10px; align-items:center;">
                    <input id="add-value" type="text" placeholder="Valor" style="width:140px; padding:6px;">
                    <button onclick="agregarDato()" style="padding:6px 12px; background-color:#28a745; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:500;">Agregar</button>
                </div>
            </div>

            <div style="margin-top:12px; padding:14px; background-color:#f9f9f9; border-radius:6px;">
                <h4 style="margin:0 0 8px 0;">Eliminar por clave</h4>
                <div style="display:flex; gap:10px; align-items:center;">
                    <input id="delete-key" type="text" placeholder="Clave a eliminar" style="width:160px; padding:6px;">
                    <button onclick="eliminarPorClave()" style="padding:6px 12px; background-color:#dc3545; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:500;">Eliminar</button>
                </div>
            </div>

            <div style="margin-top:12px; padding:14px; background-color:#f9f9f9; border-radius:6px;">
                <h4 style="margin:0 0 8px 0;">Buscar (Lineal)</h4>
                <div style="display:flex; gap:10px; align-items:center;">
                    <input id="search-key" type="text" placeholder="Clave a buscar" style="width:160px; padding:6px;">
                    <button onclick="buscarLinea()" style="padding:6px 12px; background-color:#0077a3; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:500;">Buscar</button>
                </div>
                <div id="search-result" style="margin-top:8px; color:#333;"></div>
            </div>

            <div style="margin-top:12px;">
                <button id="clear-btn" onclick="limpiarArreglo()" style="padding:8px 12px; background-color:#6c757d; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:500;">Limpiar Todo</button>
            </div>
        </div>

        <div style="flex:1;">
            <div id="array-container" style="display:none;">
                <h3>Arreglo (vacío)</h3>
                <div id="array-boxes" style="display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-start; min-height:50px; max-height:400px; overflow-y:auto; padding:6px; border:1px solid #eee; border-radius:6px;"></div>
            </div>
        </div>
    </div>
</div>

<script>
let arregloData = {};
let tamanoClave = 0;
let tamanoArreglo = 0;

function aceptarParametros() {
    const tamano = document.getElementById('size-array').value;
    const clave = document.getElementById('key-size').value;
    
    if (!clave) {
        alert('Por favor ingresa el tamaño de clave');
        return;
    }
    
    const tamanoClaveParsed = parseInt(clave);
    if (tamanoClaveParsed < 1) {
        alert('El tamaño de clave debe ser mayor a 0');
        return;
    }
    
    tamanoArreglo = parseInt(tamano);
    tamanoClave = tamanoClaveParsed;
    arregloData = {};
    document.getElementById('add-value').maxLength = tamanoClave;
    document.getElementById('array-container').style.display = 'block';
    actualizarVisualizacion();
}

function agregarDato() {
    const valor = document.getElementById('add-value').value;

    if (!valor) {
        alert('Ingresa un valor para agregar');
        return;
    }
    // validar formato: sólo dígitos y longitud <= tamanoClave
    if (!/^[0-9]+$/.test(valor) || valor.length > tamanoClave) {
        alert('La clave debe ser numérica y como máximo ' + tamanoClave + ' dígitos');
        return;
    }
    // rellenar con ceros a la izquierda si es necesario
    const padded = valor.padStart(tamanoClave, '0');

    // verificar duplicados
    for (const p in arregloData) {
        if (String(arregloData[p]) === String(padded)) {
            alert('No se permiten claves repetidas');
            return;
        }
    }

    // buscar la primera posición libre (secuencial)
    let posicionLibre = -1;
    for (let i = 1; i <= tamanoArreglo; i++) {
        if (!arregloData[i]) { posicionLibre = i; break; }
    }
    if (posicionLibre === -1) {
        alert('El arreglo está lleno');
        return;
    }

    arregloData[posicionLibre] = padded;
    document.getElementById('add-value').value = '';
    actualizarVisualizacion();
}

function eliminarPorClave() {
    let clave = document.getElementById('delete-key').value;
    if (!clave) { alert('Ingresa la clave a eliminar'); return; }
    if (!/^[0-9]+$/.test(clave) || clave.length > tamanoClave) { alert('La clave debe ser numérica y como máximo ' + tamanoClave + ' dígitos'); return; }
    clave = clave.padStart(tamanoClave, '0');
    let encontrado = false;
    for (const pos in arregloData) {
        if (String(arregloData[pos]) === String(clave)) { delete arregloData[pos]; encontrado = true; }
    }
    if (!encontrado) {
        alert('No se encontró la clave en el arreglo');
    } else {
        document.getElementById('delete-key').value = '';
        actualizarVisualizacion();
    }
}

function buscarLinea() {
    let clave = document.getElementById('search-key').value;
    const resultDiv = document.getElementById('search-result');
    resultDiv.textContent = '';
    if (!clave) { alert('Ingresa la clave a buscar'); return; }
    if (!/^[0-9]+$/.test(clave) || clave.length > tamanoClave) { alert('La clave debe ser numérica y como máximo ' + tamanoClave + ' dígitos'); return; }
    clave = clave.padStart(tamanoClave, '0');
    const posiciones = [];
    for (const pos in arregloData) {
        if (String(arregloData[pos]) === String(clave)) posiciones.push(pos);
    }
    if (posiciones.length === 0) {
        resultDiv.textContent = 'No encontrado';
        alert('No se encontró la clave');
        return;
    }
    resultDiv.textContent = 'Encontrado en posición(es): ' + posiciones.join(', ');
    // resaltar primera coincidencia
    const first = document.getElementById('cell-input-' + posiciones[0]);
    if (first) {
        const prevBg = first.style.backgroundColor;
        first.style.backgroundColor = '#fff3b0';
        first.focus();
        setTimeout(()=> first.style.backgroundColor = prevBg, 1200);
    }
}

function actualizarVisualizacion() {
    const boxesDiv = document.getElementById('array-boxes');
    boxesDiv.innerHTML = '';
    // usar envoltura y scroll vertical dentro del contenedor (evitar desplazamiento horizontal)
    boxesDiv.style.maxHeight = '400px';
    boxesDiv.style.overflowY = 'auto';
    boxesDiv.style.overflowX = 'hidden';
    boxesDiv.style.flexWrap = 'wrap';
    boxesDiv.style.alignItems = 'flex-start';
    boxesDiv.style.justifyContent = 'flex-start';
    boxesDiv.style.padding = '6px';
    
    for (let i = 1; i <= tamanoArreglo; i++) {
        const wrapper = document.createElement('div');
        wrapper.style.display = 'flex';
        wrapper.style.flexDirection = 'column';
        wrapper.style.alignItems = 'center';
        wrapper.style.gap = '6px';
        wrapper.style.margin = '4px';

        const input = document.createElement('input');
        input.type = 'text';
        input.id = 'cell-input-' + i;
        input.className = 'cell-input';
        input.value = arregloData[i] || '';
        input.maxLength = tamanoClave;
        input.placeholder = '';
        input.style.textAlign = 'center';
        if (tamanoArreglo >= 100) {
            input.style.width = '44px';
            input.style.padding = '4px';
            input.style.fontSize = '11px';
        } else {
            input.style.width = '72px';
            input.style.padding = '6px 8px';
            input.style.fontSize = '13px';
        }
        input.readOnly = true;

        const label = document.createElement('label');
        label.textContent = i;
        label.style.fontSize = tamanoArreglo >= 100 ? '10px' : '12px';
        label.style.color = '#666';

        wrapper.appendChild(input);
        wrapper.appendChild(label);
        boxesDiv.appendChild(wrapper);
    }
}

function limpiarArreglo() {
    arregloData = {};
    const addValue = document.getElementById('add-value');
    if (addValue) addValue.value = '';
    const deleteKey = document.getElementById('delete-key');
    if (deleteKey) deleteKey.value = '';
    const addPos = document.getElementById('add-position');
    if (addPos) addPos.value = '';
    actualizarVisualizacion();
}
</script>
</body>
</html>